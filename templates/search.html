<!DOCTYPE html>
<html lang="en">
<head>
  <title> SOS Reports</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- icon  -->
  <link rel="icon" type="image/png" href="/static/images/icon_t.png">

  <!-- BS and FA -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- d3 -->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter2/1.4.7/crossfilter.min.js"></script>
  <script src="//d3js.org/topojson.v3.min.js"></script>

  <!-- general style -->
  <link rel="stylesheet" href="/static/css/style.css">
  <link rel="stylesheet" href="/static/css/nondatastyle.css">

  <!--timetable -->
  <link rel="stylesheet" href="/static/css/timetable2.css">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  <!--mapbox -->
  <link rel="stylesheet" href="/static/css/map3.css">
  <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet'>


  <!-- three charts -->
  <link rel="stylesheet" href="/static/css/tablecharts2.css">

  <!-- searchpage michigan-->
  <link rel="stylesheet" href="/static/css/michigan.css">
</head>

</head>
<body>
  <nav class="navbar navbar-expand-sm fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#">SOS Michigan Opioid Epidemic Dashboard</a>
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
        <li class="nav-item active">
          <a  class="nav-link" href="#">EMS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">ED</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">ME</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container-fluid container-top-buffer">
    <div class="row content">

      <div class="col-sm-1 sidebuff"></div>

      <div class="col-sm-10 text-center top-buffer center-align">
        <h2> SOS Reports </h2>
        <div class="row border-bottom">
        {% for src in ['EMS','ED','ME'] %}
          <div class="col-sm-4 eachcol center-align" id="{{ src }}">
            <h3 class="col">{{ src }}</h3>
            <div class="{{ 'map'+src }} extraMapPadding"></div>
          </div>
        {% endfor %}
        </div>
        <h3 class="h3Padding"> Counties </h3>
        <div class='row countynames'>
          {% for county in data.counties %}
            <div class="col-sm-4">
              <p><a href='/dashboard?src={{ src }}&county={{ county }}'>{{ county }}</a></p>
            </div>
          {% endfor %}
        </div>
      </div>
        <!-- <div class="searchbar">
          <input type="text" placeholder="Search..">
        </div>
      </div>-->


      <div class="col-sm-1 sidebuff"></div>

    </div>
  </div>
  <script>
  var eachcol = document.querySelector(".eachcol");


  let width = eachcol.clientWidth;
  let height = width;

  //Create SVG element and append map to the SVG
  let EMS = d3.select(".mapEMS")
      .append("svg")
      .attr("width", width)
      .attr("transform", "translate (-25 0)")
      .attr("height", height);


  let ED = d3.select(".mapED")
      .append("svg")
      .attr("width", width)
      .attr("transform", "translate (-25 0)")
      .attr("height", height);

  let ME = d3.select(".mapME")
      .append("svg")
      .attr("width", width)
      .attr("transform", "translate (-25 0)")
      .attr("height", height);

  // Load topojson data
  async function make_map(svgname, src) {
    // Append Div for tooltip to SVG
    let tooltipDiv = d3.select(".map" + src)
        .append("div")
        .attr("class", "tooltips")
        .attr("data-toggle", "tooltip")
        .attr("data-placement", "top")

    const MItopo = await d3.json('static/geojson/gz_2010_us_050_00_5m_MI_counties.topojson')
    const cities = await d3.csv('static/data/cities.csv')
    // convert to geojson
    const MIgeo = topojson.feature(MItopo, MItopo.objects.collection)

    // D3 Projection
    let projection = d3.geoMercator()
        .fitSize([width, height], MIgeo)

    // Define path generator
    let path = d3.geoPath() // path generator that will convert GeoJSON to SVG paths
        .projection(projection);

    // Bind the data to the SVG and create one path per GeoJSON feature
    svgname.selectAll("path")
        .data(MIgeo.features)
      .enter().append("path")
        .attr('class', src+' county')
        .attr("d", path)
        .attr("id", "tooltips")
        .attr("data-toggle", "tooltip")
        .attr("title", d => d.properties.name)
        .on("click", d => window.location.href += "/dashboard?src=" + src + "&county=" + d.name)
        $(function() {
          $('[data-toggle="tooltip"]').tooltip()
        })

      svgname.selectAll('circle')
        .data(cities)
        .enter().append('circle')
          .attr('class', 'city')
          .attr('r', '4')
          .attr("data-toggle", "tooltip")
          .attr('cx', d => projection([d.lng,d.lat])[0])
          .attr('cy', d => projection([d.lng,d.lat])[1])
          .attr("title", d => d.name)
          .on("click", d => window.location.href += "/dashboard?src=" + src + "&city=" + d.name)
          $(function() {
            $('[data-toggle="tooltip"]').tooltip()
          })
    };
    function type(d) {
      d.lat = +d.lat;
      d.lng = +d.lng;
      return d
  };

  make_map(EMS, "EMS");
  make_map(ED, "ED");
  make_map(ME, "ME");

  </script>
  <footer class="footer">
      <div class="footstyle container-fluid text-center">
        <div class="row">
            <div class="col-sm-4">
              <h4> Label</h4>
              <p> thing</p>
              <p> thing </p>

            </div>
            <div class="col-sm-4">
              <h4> Label</h4>
              <p> thing</p>
              <p> thing </p>

            </div>
            <div class="col-sm-4">
              <h4> Label</h4>
              <p> thing</p>
              <p> thing </p>

            </div>
            <div class="row">
              <div class="col-sm-12">
                  <!-- <img src="/static/images/IPC.png" alt="injury prevention center"></img>
                  <img src="/static/images/hidta.png" alt="hidta"></img>
                  <img src="/static/images/SOS.png" alt="sos"></img> -->
              </div>
            </div>
          </div>
        </div>
  </footer>
</body>
</html>
